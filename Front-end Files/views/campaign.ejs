<%- include('partials/header', { title: 'Campaigns - PhishLocker' }) %> <%-
include('partials/sidebar', { page: 'campaigns' }) %>

<div class="main-content">
  <div class="container">
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 3rem;
      "
    >
      <div style="display: flex; align-items: center">
        <h1
        <span style="-webkit-text-fill-color: initial; background: none">ðŸŽ¯</span>
          <span style="
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
          "
        >
          Campaign Management
          </span>
        </h1>
      </div>
      <a href="/campaigns/new" class="btn btn-primary pulse">+ New Campaign</a>
    </div>

    <div class="glass-card">
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>Campaign Name</th>
              <th>Template</th>
              <th>Target Group</th>
              <th>Status</th>
              <th>Sent</th>
              <th>Clicked</th>
              <th>Click Rate</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% if (campaigns && campaigns.length > 0) { %> <%
            campaigns.forEach(campaign => { %>
            <tr>
              <td>
                <span style="font-weight: 600; color: white"
                  ><%= campaign.name %></span
                >
              </td>
              <td><%= campaign.template %></td>
              <td><%= campaign.targetGroup %></td>
              <td>
                <span class="badge badge-<%= campaign.status.toLowerCase() %>"
                  ><%= campaign.status %></span
                >
              </td>
              <td><%= campaign.sent || 0 %></td>
              <td><%= campaign.clicked || 0 %></td>
              <td>
                <%= campaign.sent > 0 ? Math.round((campaign.clicked /
                campaign.sent) * 100) : 0 %>%
              </td>
              <td>
                <a
                  href="/campaigns/<%= campaign.id %>"
                  class="btn btn-secondary"
                  style="padding: 0.4rem 0.8rem; font-size: 0.8rem"
                  >View</a
                >
                <% if (campaign.status === 'Draft') { %>
                <button
                  onclick="launchCampaign(<%= campaign.id %>)"
                  class="btn btn-primary"
                  style="padding: 0.4rem 0.8rem; font-size: 0.8rem"
                >
                  Launch
                </button>
                <% } %>
              </td>
            </tr>
            <% }) %> <% } else { %>
            <tr>
              <td
                colspan="8"
                style="text-align: center; color: #94a3b8; padding: 2rem"
              >
                No campaigns found.
                <a href="/campaigns/new" style="color: var(--primary-emerald)"
                  >Create your first campaign</a
                >
              </td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
  function launchCampaign(campaignId) {
    if (
      confirm(
        "Are you sure you want to launch this campaign? This will send emails to all target users."
      )
    ) {
      fetch(`/campaigns/${campaignId}/launch`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
      }).then((response) => {
        if (response.ok) {
          location.reload();
        } else {
          alert("Error launching campaign");
        }
      });
    }
  }
</script>

<%- include('partials/footer') %>
