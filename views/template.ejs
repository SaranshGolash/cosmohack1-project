<%- include('partials/header', { title: 'Templates - SecureGuard' }) %> <%-
include('partials/sidebar', { page: 'templates' }) %>

<div class="main-content">
  <div class="container">
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 3rem;
      "
    >
      <div style="display: flex; align-items: center">
        <div
          style="
            font-size: 2rem;
            margin-right: 1rem;
            filter: drop-shadow(0 0 10px rgba(6, 182, 212, 0.5));
          "
        >
          ðŸ“§
        </div>
        <h1
          style="
            margin: 0;
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
          "
        >
          Email Templates
        </h1>
      </div>
      <a
        href="/templates/new"
        class="btn btn-primary pulse"
        style="
          background: var(--gradient-primary);
          box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
        "
        >+ New Template</a
      >
    </div>

    <div class="dashboard-grid">
      <% if (templates && templates.length > 0) { %> <%
      templates.forEach(template => { %>
      <div
        class="glass-card sparkle"
        style="border-left: 4px solid var(--primary-emerald)"
      >
        <h3 style="color: white; margin-bottom: 0.5rem">
          <%= template.name %>
        </h3>
        <p style="color: #94a3b8; margin: 0.5rem 0; font-size: 0.9rem">
          <%= template.subject %>
        </p>
        <div
          style="
            font-size: 0.85rem;
            color: #64748b;
            margin-bottom: 1.5rem;
            background: rgba(0, 0, 0, 0.2);
            padding: 0.5rem;
            border-radius: 6px;
          "
        >
          From:
          <span style="color: var(--light-emerald)"
            ><%= template.senderName %></span
          >
          &lt;<%= template.senderEmail %>&gt;
        </div>
        <div style="display: flex; gap: 0.5rem; margin-top: auto">
          <a
            href="/templates/<%= template.id %>"
            class="btn btn-secondary"
            style="font-size: 0.8rem; padding: 0.5rem 1rem"
            >View</a
          >
          <% if(typeof user !== 'undefined' && user && user.role === 'admin')
          {%>
          <a
            href="/templates/<%= template.id %>/edit"
            class="btn btn-secondary"
            style="font-size: 0.8rem; padding: 0.5rem 1rem"
            >Edit</a
          >
          <button
            onclick="deleteTemplate(<%= template.id %>)"
            class="btn btn-danger"
            style="font-size: 0.8rem; padding: 0.5rem 1rem; margin-left: auto"
          >
            Delete
          </button>
          <% } %>
        </div>
      </div>
      <% }) %> <% } else { %>
      <div
        class="glass-card sparkle"
        style="grid-column: 1 / -1; text-align: center; padding: 3rem"
      >
        <h3 style="color: #cbd5e1">No Templates Found</h3>
        <p style="color: #94a3b8; margin: 1rem 0">
          Create your first email template to get started with phishing
          simulations.
        </p>
        <a href="/templates/new" class="btn btn-primary">Create Template</a>
      </div>
      <% } %>
    </div>
  </div>
</div>

<script>
  function deleteTemplate(templateId) {
    if (confirm("Are you sure you want to delete this template?")) {
      fetch(`/templates/${templateId}`, {
        method: "DELETE",
        headers: { "Content-Type": "application/json" },
      }).then((response) => {
        if (response.ok) {
          location.reload();
        } else {
          alert("Error deleting template");
        }
      });
    }
  }
</script>

<%- include('partials/footer') %>
